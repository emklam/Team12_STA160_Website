<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Airbnb Price Prediction Tool</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>


<div class="nav-wrap">
  <nav class="nav">
    <div class="brand">
      <svg class="brand-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 21V9L12 2L21 9V21H14V14H10V21H3Z" stroke="#4A90E2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M8 10L12 6L16 10" stroke="#4A90E2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>CalHousing</span>
    </div>
    <a href="index.html">Home</a>
    <a href="predictor.html" >Housing Price Prediction</a>
    <a href="airbnb_predictor.html" class="active">Airbnb Price Prediction</a>
    <a href="map.html">Housing Map</a>
    <a href="airbnb-map.html">Airbnb Map</a>
    <a href="trends.html">Housing Trends Dashboard</a>
  </nav>
</div>

  <div class="container">
    <div class="predictor-header">
      <h1>Airbnb Price Prediction Tool</h1>
      <p class="caption">Provide the details below and our model will estimate the nightly price for the Airbnb listing.</p>
    </div>

    <div class="predictor-content">
      <!-- Left Section: Input Form -->
      <div class="predictor-form-card">
        <div class="form-group">
          <label for="location">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            Location (County)
          </label>
          <select id="location">
            <option value="">Select a county...</option>
            <option value="Los Angeles">Los Angeles</option>
            <option value="San Diego">San Diego</option>
            <option value="Santa Clara">Santa Clara</option>
            <option value="San Mateo">San Mateo</option>
            <option value="Alameda">Alameda</option>
            <option value="Santa Cruz">Santa Cruz</option>
            <option value="Monterey">Monterey</option>
          </select>
        </div>

        <div class="form-group">
          <label for="bedrooms">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Bedrooms
          </label>
          <input type="number" id="bedrooms" placeholder="e.g., 3" />
        </div>

        <div class="form-group">
          <label for="bathrooms">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 6L6 3L3 6v6a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3V6l-3-3-3 3z"></path>
              <path d="M9 21V12h6v9"></path>
            </svg>
            Bathrooms
          </label>
          <input type="number" id="bathrooms" placeholder="e.g., 2" />
        </div>

        <div class="form-group">
          <label for="total-rooms">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="3" y1="9" x2="21" y2="9"></line>
              <line x1="9" y1="21" x2="9" y2="9"></line>
            </svg>
            Total Rooms
          </label>
          <input type="number" id="total-rooms" placeholder="e.g., 5" />
        </div>

        <div class="form-group">
          <label for="crime-rate">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 6v6l4 2"></path>
            </svg>
            Crime Rate
            <span class="slider-value" id="crime-rate-value">0.50</span>
          </label>
          <input type="range" id="crime-rate" min="0" max="1" step="0.01" value="0.5" />
        </div>

        <div class="form-group">
          <label for="avg-income">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            Average County Income
            <span class="slider-value" id="avg-income-value">$235,000</span>
          </label>
          <input type="range" id="avg-income" min="70000" max="400000" step="1000" value="235000" />
        </div>

        <button class="predict-button" id="predict-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
          </svg>
          Predict Price
        </button>
      </div>

      <!-- Right Section: Prediction Display -->
      <div class="predictor-result-card">
        <div class="result-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#4A90E2" stroke-width="2">
            <path d="M3 21V9L12 2L21 9V21H14V14H10V21H3Z"></path>
            <path d="M8 10L12 6L16 10"></path>
          </svg>
        </div>
        <h2>Predicted Airbnb Price</h2>
        <div class="predicted-value" id="predicted-value">$150/night</div>
        <p class="result-disclaimer">This is an estimate based on a predictive model and current market data. Actual nightly price may vary.</p>
      </div>
    </div>
  </div>
<div class="footer">© 2024 California Housing (Team 12). For course demo only.</div>

<script>
// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
  // -------- Slider display logic (keep this behavior) --------
  const crimeRateSlider = document.getElementById('crime-rate');
  const crimeRateValue = document.getElementById('crime-rate-value');
  const avgIncomeSlider = document.getElementById('avg-income');
  const avgIncomeValue = document.getElementById('avg-income-value');

  if (crimeRateSlider && crimeRateValue) {
    crimeRateSlider.addEventListener('input', (e) => {
      crimeRateValue.textContent = parseFloat(e.target.value).toFixed(2);
    });
  }

  if (avgIncomeSlider && avgIncomeValue) {
    avgIncomeSlider.addEventListener('input', (e) => {
      const value = parseInt(e.target.value);
      avgIncomeValue.textContent = '$' + value.toLocaleString();
    });
  }

  // -------- API call logic --------
  const predictBtn = document.getElementById('predict-btn');
  const predictedValueEl = document.getElementById('predicted-value');

  // ★★★★★ Replace localhost with your Render backend URL ★★★★★
  const API_URL = "https://team12-sta160-api3-1.onrender.com/predict";

  async function callPrediction() {
    // 1) Read values from form
    const rawLocation = document.getElementById('location').value;
    if (!rawLocation) {
      alert('Please select a county');
      if (predictedValueEl) {
        predictedValueEl.textContent = 'Please select a county';
      }
      return;
    }
    const city = rawLocation.trim();

    const bedrooms = Number(document.getElementById('bedrooms').value) || 0;
    const bathrooms = Number(document.getElementById('bathrooms').value) || 0;
    const totalRooms = Number(document.getElementById('total-rooms').value) || 0;

    // simple guess for beds
    const beds = Math.max(bedrooms, 1);

    // 2) Build features dict (must match model feature names)
    const features = {
      bathrooms: bathrooms,
      bedrooms: bedrooms,
      beds: beds,

      "shared_bathroom": 0,
      "air conditioning": 1,
      "bathtub": 0,
      "dishwasher": 1,
      "dryer": 1,
      "freezer": 1,
      "heating": 1,
      "hot water": 1,
      "oven": 1,
      "parking": 0,
      "refrigerator": 1,
      "stove": 1,
      "tv": 1,
      "washer": 1,
      "wifi": 1
    };

    // 3) Show loading
    if (predictedValueEl) {
      predictedValueEl.textContent = 'Predicting...';
    }

    try {

      // ★★★★★ Final: call real backend ★★★★★
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ city, features }),
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.detail || ('Request failed with status ' + res.status));
      }

      const data = await res.json();

      // 你的后端返回的是 predicted_price
      let price = data.predicted_price;
          
      // 兼容一下其它可能的字段名（防止以后你改后端）
      if (price === undefined || price === null) {
        price = data.prediction;
      }
      if (price === undefined || price === null) {
        price = data.price;
      }
      
      price = Number(price);
      
      if (!isFinite(price)) {
        throw new Error("API returned invalid price: " + JSON.stringify(data));
      }
      
      if (predictedValueEl) {
        predictedValueEl.textContent = '$' + price.toFixed(0) + '/night';
      }


    } catch (err) {
      console.error(err);
      if (predictedValueEl) {
        predictedValueEl.textContent = 'Error fetching prediction';
      }
    }
  }

  if (predictBtn) {
    predictBtn.addEventListener('click', (e) => {
      e.preventDefault();
      callPrediction();
    });
  }
});
</script>



</body>
</html>
